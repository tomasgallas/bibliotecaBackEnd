∏A
?C:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddDbContext

 
<

 
BibliotecaContext

 /
>

/ 0
(

0 1
opts

1 5
=>

6 8
opts 
. 	
	UseSqlite	 
( 
$str .
). /
)/ 0
;0 1
builder 
. 
Services 
. 
AddIdentity 
< 
ApplicationUser ,
,, -
IdentityRole. :
>: ;
(; <
opts< @
=>A C
{ 
opts 
. 
User 
. 
RequireUniqueEmail $
=% &
true' +
;+ ,
opts 
. 
Password 
. 
RequiredLength $
=% &
$num' (
;( )
} 
) 
. $
AddEntityFrameworkStores 
< 
BibliotecaContext /
>/ 0
(0 1
)1 2
. $
AddDefaultTokenProviders 
( 
) 
;  
builder 
. 
Services 
. &
ConfigureApplicationCookie +
(+ ,
opts, 0
=>1 3
{ 
opts 
. 	
Cookie	 
. 
HttpOnly 
= 
true !
;! "
opts 
. 	
Cookie	 
. 
SameSite 
= 
SameSiteMode )
.) *
Strict* 0
;0 1
opts 
. 	
ExpireTimeSpan	 
= 
TimeSpan %
.% &
	FromHours& /
(/ 0
$num0 1
)1 2
;2 3
opts 
. 	
	LoginPath	 
= 
$str /
;/ 0
opts 
. 	
AccessDeniedPath	 
= 
$str 3
;3 4
} 
) 
; 
builder!! 
.!! 
Services!! 
.!! 
AddCors!! 
(!! 
options!!  
=>!!! #
{"" 
options## 
.## 
AddDefaultPolicy## 
(## 
policy## #
=>##$ &
policy$$ 
.$$ 
WithOrigins$$ 
($$ 
$str$$ 2
)$$2 3
.%% 
AllowAnyHeader%% 
(%% 
)%% 
.&& 
AllowAnyMethod&& 
(&& 
)&& 
)'' 
;'' 
}(( 
)(( 
;(( 
builder++ 
.++ 
Services++ 
.++ 
AddControllers++ 
(++  
)++  !
;++! "
builder,, 
.,, 
Services,, 
.,, #
AddEndpointsApiExplorer,, (
(,,( )
),,) *
;,,* +
builder-- 
.-- 
Services-- 
.-- 
AddSwaggerGen-- 
(-- 
)--  
;--  !
var// 
app// 
=// 	
builder//
 
.// 
Build// 
(// 
)// 
;// 
using22 
(22 
var22 	
scope22
 
=22 
app22 
.22 
Services22 
.22 
CreateScope22 *
(22* +
)22+ ,
)22, -
{33 
var44 
ctx44 
=44 
scope44 
.44 
ServiceProvider44 '
.44' (
GetRequiredService44( :
<44: ;
BibliotecaContext44; L
>44L M
(44M N
)44N O
;44O P
var55 
userMgr55 
=55 
scope55 
.55 
ServiceProvider55 '
.55' (
GetRequiredService55( :
<55: ;
UserManager55; F
<55F G
ApplicationUser55G V
>55V W
>55W X
(55X Y
)55Y Z
;55Z [
var66 
roleMgr66 
=66 
scope66 
.66 
ServiceProvider66 '
.66' (
GetRequiredService66( :
<66: ;
RoleManager66; F
<66F G
IdentityRole66G S
>66S T
>66T U
(66U V
)66V W
;66W X
ctx88 
.88 
Database88 
.88 
Migrate88 
(88 
)88 
;88 
foreach;; 
(;; 
var;; 
role;; 
in;; 
new;; 
[;; 
];; 
{;; 
$str;; &
,;;& '
$str;;( 7
,;;7 8
$str;;9 A
};;B C
);;C D
if<< 

(<< 
!<< 
await<< 
roleMgr<< 
.<< 
RoleExistsAsync<< *
(<<* +
role<<+ /
)<</ 0
)<<0 1
await== 
roleMgr== 
.== 
CreateAsync== %
(==% &
new==& )
IdentityRole==* 6
(==6 7
role==7 ;
)==; <
)==< =
;=== >
async@@ 	
Task@@
 

EnsureUser@@ 
(@@ 
string@@  
email@@! &
,@@& '
string@@( .
name@@/ 3
,@@3 4
string@@5 ;
pw@@< >
,@@> ?
string@@@ F
role@@G K
)@@K L
{AA 
ifBB 

(BB 
awaitBB 
userMgrBB 
.BB 
FindByEmailAsyncBB *
(BB* +
emailBB+ 0
)BB0 1
==BB2 4
nullBB5 9
)BB9 :
{CC 	
varDD 
uDD 
=DD 
newDD 
ApplicationUserDD '
{DD( )
UserNameDD* 2
=DD3 4
emailDD5 :
,DD: ;
EmailDD< A
=DDB C
emailDDD I
,DDI J
NameDDK O
=DDP Q
nameDDR V
}DDW X
;DDX Y
awaitEE 
userMgrEE 
.EE 
CreateAsyncEE %
(EE% &
uEE& '
,EE' (
pwEE) +
)EE+ ,
;EE, -
awaitFF 
userMgrFF 
.FF 
AddToRoleAsyncFF (
(FF( )
uFF) *
,FF* +
roleFF, 0
)FF0 1
;FF1 2
}GG 	
}HH 
awaitII 	

EnsureUserII
 
(II 
$strII '
,II' (
$strII) 0
,II0 1
$strII2 =
,II= >
$strII? F
)IIF G
;IIG H
awaitJJ 	

EnsureUserJJ
 
(JJ 
$strJJ (
,JJ( )
$strJJ* 2
,JJ2 3
$strJJ4 @
,JJ@ A
$strJJB Q
)JJQ R
;JJR S
awaitKK 	

EnsureUserKK
 
(KK 
$strKK (
,KK( )
$strKK* 2
,KK2 3
$strKK4 @
,KK@ A
$strKKB J
)KKJ K
;KKK L
}LL 
ifOO 
(OO 
appOO 
.OO 
EnvironmentOO 
.OO 
IsDevelopmentOO !
(OO! "
)OO" #
)OO# $
{PP 
appQQ 
.QQ 

UseSwaggerQQ 
(QQ 
)QQ 
;QQ 
appRR 
.RR 
UseSwaggerUIRR 
(RR 
)RR 
;RR 
}SS 
appUU 
.UU 
UseHttpsRedirectionUU 
(UU 
)UU 
;UU 
appVV 
.VV 
UseCorsVV 
(VV 
)VV 
;VV 
appWW 
.WW 
UseAuthenticationWW 
(WW 
)WW 
;WW 
appXX 
.XX 
UseAuthorizationXX 
(XX 
)XX 
;XX 
appYY 
.YY 
MapControllersYY 
(YY 
)YY 
;YY 
appZZ 
.ZZ 
RunZZ 
(ZZ 
)ZZ 	
;ZZ	 
Ü
EC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Models\Author.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Models 
{ 
public 

class 
Author 
{ 
public 
int 
Id 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Name 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
ICollection		 
<		 
Book		 
>		  
Books		! &
{		' (
get		) ,
;		, -
set		. 1
;		1 2
}		3 4
=		5 6
new		7 :
List		; ?
<		? @
Book		@ D
>		D E
(		E F
)		F G
;		G H
}

 
} «
NC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Models\ApplicationUser.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Models 
{ 
public 

class 
ApplicationUser  
:! "
IdentityUser# /
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
}		 
}

 Ë
CC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Models\Book.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Models 
{ 
public 

class 
Book 
{ 
public 
int 
Id 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Title 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int 
AuthorId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Author 
? 
Author 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Ë&
_C:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Migrations\20250608213101_InitialCreate.cs
	namespace 	

Biblioteca
 
. 
Api 
. 

Migrations #
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Title   
=   
table   !
.  ! "
Column  " (
<  ( )
string  ) /
>  / 0
(  0 1
type  1 5
:  5 6
$str  7 =
,  = >
nullable  ? G
:  G H
false  I N
)  N O
,  O P
AuthorId!! 
=!! 
table!! $
.!!$ %
Column!!% +
<!!+ ,
int!!, /
>!!/ 0
(!!0 1
type!!1 5
:!!5 6
$str!!7 @
,!!@ A
nullable!!B J
:!!J K
false!!L Q
)!!Q R
}"" 
,"" 
constraints## 
:## 
table## "
=>### %
{$$ 
table%% 
.%% 

PrimaryKey%% $
(%%$ %
$str%%% /
,%%/ 0
x%%1 2
=>%%3 5
x%%6 7
.%%7 8
Id%%8 :
)%%: ;
;%%; <
table&& 
.&& 

ForeignKey&& $
(&&$ %
name'' 
:'' 
$str'' 9
,''9 :
column(( 
:(( 
x((  !
=>((" $
x((% &
.((& '
AuthorId((' /
,((/ 0
principalTable)) &
:))& '
$str))( 1
,))1 2
principalColumn** '
:**' (
$str**) -
,**- .
onDelete++  
:++  !
ReferentialAction++" 3
.++3 4
Cascade++4 ;
)++; <
;++< =
},, 
),, 
;,, 
migrationBuilder.. 
... 
CreateIndex.. (
(..( )
name// 
:// 
$str// )
,//) *
table00 
:00 
$str00 
,00 
column11 
:11 
$str11 "
)11" #
;11# $
}22 	
	protected55 
override55 
void55 
Down55  $
(55$ %
MigrationBuilder55% 5
migrationBuilder556 F
)55F G
{66 	
migrationBuilder77 
.77 
	DropTable77 &
(77& '
name88 
:88 
$str88 
)88 
;88 
migrationBuilder:: 
.:: 
	DropTable:: &
(::& '
name;; 
:;; 
$str;; 
);;  
;;;  !
}<< 	
}== 
}>> ‡…
]C:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Migrations\20250616225256_AddIdentity.cs
	namespace 	

Biblioteca
 
. 
Api 
. 

Migrations #
{ 
public		 

partial		 
class		 
AddIdentity		 $
:		% &
	Migration		' 0
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ F
,F G
	maxLengthH Q
:Q R
$numS V
,V W
nullableX `
:` a
trueb f
)f g
,g h
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
type< @
:@ A
$strB H
,H I
nullableJ R
:R S
trueT X
)X Y
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id   
=   
table   
.   
Column   %
<  % &
string  & ,
>  , -
(  - .
type  . 2
:  2 3
$str  4 :
,  : ;
nullable  < D
:  D E
false  F K
)  K L
,  L M
Name!! 
=!! 
table!!  
.!!  !
Column!!! '
<!!' (
string!!( .
>!!. /
(!!/ 0
type!!0 4
:!!4 5
$str!!6 <
,!!< =
nullable!!> F
:!!F G
false!!H M
)!!M N
,!!N O
	CreatedAt"" 
="" 
table""  %
.""% &
Column""& ,
<"", -
DateTime""- 5
>""5 6
(""6 7
type""7 ;
:""; <
$str""= C
,""C D
nullable""E M
:""M N
false""O T
)""T U
,""U V
UserName## 
=## 
table## $
.##$ %
Column##% +
<##+ ,
string##, 2
>##2 3
(##3 4
type##4 8
:##8 9
$str##: @
,##@ A
	maxLength##B K
:##K L
$num##M P
,##P Q
nullable##R Z
:##Z [
true##\ `
)##` a
,##a b
NormalizedUserName$$ &
=$$' (
table$$) .
.$$. /
Column$$/ 5
<$$5 6
string$$6 <
>$$< =
($$= >
type$$> B
:$$B C
$str$$D J
,$$J K
	maxLength$$L U
:$$U V
$num$$W Z
,$$Z [
nullable$$\ d
:$$d e
true$$f j
)$$j k
,$$k l
Email%% 
=%% 
table%% !
.%%! "
Column%%" (
<%%( )
string%%) /
>%%/ 0
(%%0 1
type%%1 5
:%%5 6
$str%%7 =
,%%= >
	maxLength%%? H
:%%H I
$num%%J M
,%%M N
nullable%%O W
:%%W X
true%%Y ]
)%%] ^
,%%^ _
NormalizedEmail&& #
=&&$ %
table&&& +
.&&+ ,
Column&&, 2
<&&2 3
string&&3 9
>&&9 :
(&&: ;
type&&; ?
:&&? @
$str&&A G
,&&G H
	maxLength&&I R
:&&R S
$num&&T W
,&&W X
nullable&&Y a
:&&a b
true&&c g
)&&g h
,&&h i
EmailConfirmed'' "
=''# $
table''% *
.''* +
Column''+ 1
<''1 2
bool''2 6
>''6 7
(''7 8
type''8 <
:''< =
$str''> G
,''G H
nullable''I Q
:''Q R
false''S X
)''X Y
,''Y Z
PasswordHash((  
=((! "
table((# (
.((( )
Column(() /
<((/ 0
string((0 6
>((6 7
(((7 8
type((8 <
:((< =
$str((> D
,((D E
nullable((F N
:((N O
true((P T
)((T U
,((U V
SecurityStamp)) !
=))" #
table))$ )
.))) *
Column))* 0
<))0 1
string))1 7
>))7 8
())8 9
type))9 =
:))= >
$str))? E
,))E F
nullable))G O
:))O P
true))Q U
)))U V
,))V W
ConcurrencyStamp** $
=**% &
table**' ,
.**, -
Column**- 3
<**3 4
string**4 :
>**: ;
(**; <
type**< @
:**@ A
$str**B H
,**H I
nullable**J R
:**R S
true**T X
)**X Y
,**Y Z
PhoneNumber++ 
=++  !
table++" '
.++' (
Column++( .
<++. /
string++/ 5
>++5 6
(++6 7
type++7 ;
:++; <
$str++= C
,++C D
nullable++E M
:++M N
true++O S
)++S T
,++T U 
PhoneNumberConfirmed,, (
=,,) *
table,,+ 0
.,,0 1
Column,,1 7
<,,7 8
bool,,8 <
>,,< =
(,,= >
type,,> B
:,,B C
$str,,D M
,,,M N
nullable,,O W
:,,W X
false,,Y ^
),,^ _
,,,_ `
TwoFactorEnabled-- $
=--% &
table--' ,
.--, -
Column--- 3
<--3 4
bool--4 8
>--8 9
(--9 :
type--: >
:--> ?
$str--@ I
,--I J
nullable--K S
:--S T
false--U Z
)--Z [
,--[ \

LockoutEnd.. 
=..  
table..! &
...& '
Column..' -
<..- .
DateTimeOffset... <
>..< =
(..= >
type..> B
:..B C
$str..D J
,..J K
nullable..L T
:..T U
true..V Z
)..Z [
,..[ \
LockoutEnabled// "
=//# $
table//% *
.//* +
Column//+ 1
<//1 2
bool//2 6
>//6 7
(//7 8
type//8 <
://< =
$str//> G
,//G H
nullable//I Q
://Q R
false//S X
)//X Y
,//Y Z
AccessFailedCount00 %
=00& '
table00( -
.00- .
Column00. 4
<004 5
int005 8
>008 9
(009 :
type00: >
:00> ?
$str00@ I
,00I J
nullable00K S
:00S T
false00U Z
)00Z [
}11 
,11 
constraints22 
:22 
table22 "
=>22# %
{33 
table44 
.44 

PrimaryKey44 $
(44$ %
$str44% 5
,445 6
x447 8
=>449 ;
x44< =
.44= >
Id44> @
)44@ A
;44A B
}55 
)55 
;55 
migrationBuilder77 
.77 
CreateTable77 (
(77( )
name88 
:88 
$str88 (
,88( )
columns99 
:99 
table99 
=>99 !
new99" %
{:: 
Id;; 
=;; 
table;; 
.;; 
Column;; %
<;;% &
int;;& )
>;;) *
(;;* +
type;;+ /
:;;/ 0
$str;;1 :
,;;: ;
nullable;;< D
:;;D E
false;;F K
);;K L
.<< 

Annotation<< #
(<<# $
$str<<$ :
,<<: ;
true<<< @
)<<@ A
,<<A B
RoleId== 
=== 
table== "
.==" #
Column==# )
<==) *
string==* 0
>==0 1
(==1 2
type==2 6
:==6 7
$str==8 >
,==> ?
nullable==@ H
:==H I
false==J O
)==O P
,==P Q
	ClaimType>> 
=>> 
table>>  %
.>>% &
Column>>& ,
<>>, -
string>>- 3
>>>3 4
(>>4 5
type>>5 9
:>>9 :
$str>>; A
,>>A B
nullable>>C K
:>>K L
true>>M Q
)>>Q R
,>>R S

ClaimValue?? 
=??  
table??! &
.??& '
Column??' -
<??- .
string??. 4
>??4 5
(??5 6
type??6 :
:??: ;
$str??< B
,??B C
nullable??D L
:??L M
true??N R
)??R S
}@@ 
,@@ 
constraintsAA 
:AA 
tableAA "
=>AA# %
{BB 
tableCC 
.CC 

PrimaryKeyCC $
(CC$ %
$strCC% :
,CC: ;
xCC< =
=>CC> @
xCCA B
.CCB C
IdCCC E
)CCE F
;CCF G
tableDD 
.DD 

ForeignKeyDD $
(DD$ %
nameEE 
:EE 
$strEE F
,EEF G
columnFF 
:FF 
xFF  !
=>FF" $
xFF% &
.FF& '
RoleIdFF' -
,FF- .
principalTableGG &
:GG& '
$strGG( 5
,GG5 6
principalColumnHH '
:HH' (
$strHH) -
,HH- .
onDeleteII  
:II  !
ReferentialActionII" 3
.II3 4
CascadeII4 ;
)II; <
;II< =
}JJ 
)JJ 
;JJ 
migrationBuilderLL 
.LL 
CreateTableLL (
(LL( )
nameMM 
:MM 
$strMM (
,MM( )
columnsNN 
:NN 
tableNN 
=>NN !
newNN" %
{OO 
IdPP 
=PP 
tablePP 
.PP 
ColumnPP %
<PP% &
intPP& )
>PP) *
(PP* +
typePP+ /
:PP/ 0
$strPP1 :
,PP: ;
nullablePP< D
:PPD E
falsePPF K
)PPK L
.QQ 

AnnotationQQ #
(QQ# $
$strQQ$ :
,QQ: ;
trueQQ< @
)QQ@ A
,QQA B
UserIdRR 
=RR 
tableRR "
.RR" #
ColumnRR# )
<RR) *
stringRR* 0
>RR0 1
(RR1 2
typeRR2 6
:RR6 7
$strRR8 >
,RR> ?
nullableRR@ H
:RRH I
falseRRJ O
)RRO P
,RRP Q
	ClaimTypeSS 
=SS 
tableSS  %
.SS% &
ColumnSS& ,
<SS, -
stringSS- 3
>SS3 4
(SS4 5
typeSS5 9
:SS9 :
$strSS; A
,SSA B
nullableSSC K
:SSK L
trueSSM Q
)SSQ R
,SSR S

ClaimValueTT 
=TT  
tableTT! &
.TT& '
ColumnTT' -
<TT- .
stringTT. 4
>TT4 5
(TT5 6
typeTT6 :
:TT: ;
$strTT< B
,TTB C
nullableTTD L
:TTL M
trueTTN R
)TTR S
}UU 
,UU 
constraintsVV 
:VV 
tableVV "
=>VV# %
{WW 
tableXX 
.XX 

PrimaryKeyXX $
(XX$ %
$strXX% :
,XX: ;
xXX< =
=>XX> @
xXXA B
.XXB C
IdXXC E
)XXE F
;XXF G
tableYY 
.YY 

ForeignKeyYY $
(YY$ %
nameZZ 
:ZZ 
$strZZ F
,ZZF G
column[[ 
:[[ 
x[[  !
=>[[" $
x[[% &
.[[& '
UserId[[' -
,[[- .
principalTable\\ &
:\\& '
$str\\( 5
,\\5 6
principalColumn]] '
:]]' (
$str]]) -
,]]- .
onDelete^^  
:^^  !
ReferentialAction^^" 3
.^^3 4
Cascade^^4 ;
)^^; <
;^^< =
}__ 
)__ 
;__ 
migrationBuilderaa 
.aa 
CreateTableaa (
(aa( )
namebb 
:bb 
$strbb (
,bb( )
columnscc 
:cc 
tablecc 
=>cc !
newcc" %
{dd 
LoginProvideree !
=ee" #
tableee$ )
.ee) *
Columnee* 0
<ee0 1
stringee1 7
>ee7 8
(ee8 9
typeee9 =
:ee= >
$stree? E
,eeE F
nullableeeG O
:eeO P
falseeeQ V
)eeV W
,eeW X
ProviderKeyff 
=ff  !
tableff" '
.ff' (
Columnff( .
<ff. /
stringff/ 5
>ff5 6
(ff6 7
typeff7 ;
:ff; <
$strff= C
,ffC D
nullableffE M
:ffM N
falseffO T
)ffT U
,ffU V
ProviderDisplayNamegg '
=gg( )
tablegg* /
.gg/ 0
Columngg0 6
<gg6 7
stringgg7 =
>gg= >
(gg> ?
typegg? C
:ggC D
$strggE K
,ggK L
nullableggM U
:ggU V
trueggW [
)gg[ \
,gg\ ]
UserIdhh 
=hh 
tablehh "
.hh" #
Columnhh# )
<hh) *
stringhh* 0
>hh0 1
(hh1 2
typehh2 6
:hh6 7
$strhh8 >
,hh> ?
nullablehh@ H
:hhH I
falsehhJ O
)hhO P
}ii 
,ii 
constraintsjj 
:jj 
tablejj "
=>jj# %
{kk 
tablell 
.ll 

PrimaryKeyll $
(ll$ %
$strll% :
,ll: ;
xll< =
=>ll> @
newllA D
{llE F
xllG H
.llH I
LoginProviderllI V
,llV W
xllX Y
.llY Z
ProviderKeyllZ e
}llf g
)llg h
;llh i
tablemm 
.mm 

ForeignKeymm $
(mm$ %
namenn 
:nn 
$strnn F
,nnF G
columnoo 
:oo 
xoo  !
=>oo" $
xoo% &
.oo& '
UserIdoo' -
,oo- .
principalTablepp &
:pp& '
$strpp( 5
,pp5 6
principalColumnqq '
:qq' (
$strqq) -
,qq- .
onDeleterr  
:rr  !
ReferentialActionrr" 3
.rr3 4
Cascaderr4 ;
)rr; <
;rr< =
}ss 
)ss 
;ss 
migrationBuilderuu 
.uu 
CreateTableuu (
(uu( )
namevv 
:vv 
$strvv '
,vv' (
columnsww 
:ww 
tableww 
=>ww !
newww" %
{xx 
UserIdyy 
=yy 
tableyy "
.yy" #
Columnyy# )
<yy) *
stringyy* 0
>yy0 1
(yy1 2
typeyy2 6
:yy6 7
$stryy8 >
,yy> ?
nullableyy@ H
:yyH I
falseyyJ O
)yyO P
,yyP Q
RoleIdzz 
=zz 
tablezz "
.zz" #
Columnzz# )
<zz) *
stringzz* 0
>zz0 1
(zz1 2
typezz2 6
:zz6 7
$strzz8 >
,zz> ?
nullablezz@ H
:zzH I
falsezzJ O
)zzO P
}{{ 
,{{ 
constraints|| 
:|| 
table|| "
=>||# %
{}} 
table~~ 
.~~ 

PrimaryKey~~ $
(~~$ %
$str~~% 9
,~~9 :
x~~; <
=>~~= ?
new~~@ C
{~~D E
x~~F G
.~~G H
UserId~~H N
,~~N O
x~~P Q
.~~Q R
RoleId~~R X
}~~Y Z
)~~Z [
;~~[ \
table 
. 

ForeignKey $
($ %
name
ÄÄ 
:
ÄÄ 
$str
ÄÄ E
,
ÄÄE F
column
ÅÅ 
:
ÅÅ 
x
ÅÅ  !
=>
ÅÅ" $
x
ÅÅ% &
.
ÅÅ& '
RoleId
ÅÅ' -
,
ÅÅ- .
principalTable
ÇÇ &
:
ÇÇ& '
$str
ÇÇ( 5
,
ÇÇ5 6
principalColumn
ÉÉ '
:
ÉÉ' (
$str
ÉÉ) -
,
ÉÉ- .
onDelete
ÑÑ  
:
ÑÑ  !
ReferentialAction
ÑÑ" 3
.
ÑÑ3 4
Cascade
ÑÑ4 ;
)
ÑÑ; <
;
ÑÑ< =
table
ÖÖ 
.
ÖÖ 

ForeignKey
ÖÖ $
(
ÖÖ$ %
name
ÜÜ 
:
ÜÜ 
$str
ÜÜ E
,
ÜÜE F
column
áá 
:
áá 
x
áá  !
=>
áá" $
x
áá% &
.
áá& '
UserId
áá' -
,
áá- .
principalTable
àà &
:
àà& '
$str
àà( 5
,
àà5 6
principalColumn
ââ '
:
ââ' (
$str
ââ) -
,
ââ- .
onDelete
ää  
:
ää  !
ReferentialAction
ää" 3
.
ää3 4
Cascade
ää4 ;
)
ää; <
;
ää< =
}
ãã 
)
ãã 
;
ãã 
migrationBuilder
çç 
.
çç 
CreateTable
çç (
(
çç( )
name
éé 
:
éé 
$str
éé (
,
éé( )
columns
èè 
:
èè 
table
èè 
=>
èè !
new
èè" %
{
êê 
UserId
ëë 
=
ëë 
table
ëë "
.
ëë" #
Column
ëë# )
<
ëë) *
string
ëë* 0
>
ëë0 1
(
ëë1 2
type
ëë2 6
:
ëë6 7
$str
ëë8 >
,
ëë> ?
nullable
ëë@ H
:
ëëH I
false
ëëJ O
)
ëëO P
,
ëëP Q
LoginProvider
íí !
=
íí" #
table
íí$ )
.
íí) *
Column
íí* 0
<
íí0 1
string
íí1 7
>
íí7 8
(
íí8 9
type
íí9 =
:
íí= >
$str
íí? E
,
ííE F
nullable
ííG O
:
ííO P
false
ííQ V
)
ííV W
,
ííW X
Name
ìì 
=
ìì 
table
ìì  
.
ìì  !
Column
ìì! '
<
ìì' (
string
ìì( .
>
ìì. /
(
ìì/ 0
type
ìì0 4
:
ìì4 5
$str
ìì6 <
,
ìì< =
nullable
ìì> F
:
ììF G
false
ììH M
)
ììM N
,
ììN O
Value
îî 
=
îî 
table
îî !
.
îî! "
Column
îî" (
<
îî( )
string
îî) /
>
îî/ 0
(
îî0 1
type
îî1 5
:
îî5 6
$str
îî7 =
,
îî= >
nullable
îî? G
:
îîG H
true
îîI M
)
îîM N
}
ïï 
,
ïï 
constraints
ññ 
:
ññ 
table
ññ "
=>
ññ# %
{
óó 
table
òò 
.
òò 

PrimaryKey
òò $
(
òò$ %
$str
òò% :
,
òò: ;
x
òò< =
=>
òò> @
new
òòA D
{
òòE F
x
òòG H
.
òòH I
UserId
òòI O
,
òòO P
x
òòQ R
.
òòR S
LoginProvider
òòS `
,
òò` a
x
òòb c
.
òòc d
Name
òòd h
}
òòi j
)
òòj k
;
òòk l
table
ôô 
.
ôô 

ForeignKey
ôô $
(
ôô$ %
name
öö 
:
öö 
$str
öö F
,
ööF G
column
õõ 
:
õõ 
x
õõ  !
=>
õõ" $
x
õõ% &
.
õõ& '
UserId
õõ' -
,
õõ- .
principalTable
úú &
:
úú& '
$str
úú( 5
,
úú5 6
principalColumn
ùù '
:
ùù' (
$str
ùù) -
,
ùù- .
onDelete
ûû  
:
ûû  !
ReferentialAction
ûû" 3
.
ûû3 4
Cascade
ûû4 ;
)
ûû; <
;
ûû< =
}
üü 
)
üü 
;
üü 
migrationBuilder
°° 
.
°° 
CreateIndex
°° (
(
°°( )
name
¢¢ 
:
¢¢ 
$str
¢¢ 2
,
¢¢2 3
table
££ 
:
££ 
$str
££ )
,
££) *
column
§§ 
:
§§ 
$str
§§  
)
§§  !
;
§§! "
migrationBuilder
¶¶ 
.
¶¶ 
CreateIndex
¶¶ (
(
¶¶( )
name
ßß 
:
ßß 
$str
ßß %
,
ßß% &
table
®® 
:
®® 
$str
®® $
,
®®$ %
column
©© 
:
©© 
$str
©© (
,
©©( )
unique
™™ 
:
™™ 
true
™™ 
)
™™ 
;
™™ 
migrationBuilder
¨¨ 
.
¨¨ 
CreateIndex
¨¨ (
(
¨¨( )
name
≠≠ 
:
≠≠ 
$str
≠≠ 2
,
≠≠2 3
table
ÆÆ 
:
ÆÆ 
$str
ÆÆ )
,
ÆÆ) *
column
ØØ 
:
ØØ 
$str
ØØ  
)
ØØ  !
;
ØØ! "
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
≤≤ 
:
≤≤ 
$str
≤≤ 2
,
≤≤2 3
table
≥≥ 
:
≥≥ 
$str
≥≥ )
,
≥≥) *
column
¥¥ 
:
¥¥ 
$str
¥¥  
)
¥¥  !
;
¥¥! "
migrationBuilder
∂∂ 
.
∂∂ 
CreateIndex
∂∂ (
(
∂∂( )
name
∑∑ 
:
∑∑ 
$str
∑∑ 1
,
∑∑1 2
table
∏∏ 
:
∏∏ 
$str
∏∏ (
,
∏∏( )
column
ππ 
:
ππ 
$str
ππ  
)
ππ  !
;
ππ! "
migrationBuilder
ªª 
.
ªª 
CreateIndex
ªª (
(
ªª( )
name
ºº 
:
ºº 
$str
ºº "
,
ºº" #
table
ΩΩ 
:
ΩΩ 
$str
ΩΩ $
,
ΩΩ$ %
column
ææ 
:
ææ 
$str
ææ )
)
ææ) *
;
ææ* +
migrationBuilder
¿¿ 
.
¿¿ 
CreateIndex
¿¿ (
(
¿¿( )
name
¡¡ 
:
¡¡ 
$str
¡¡ %
,
¡¡% &
table
¬¬ 
:
¬¬ 
$str
¬¬ $
,
¬¬$ %
column
√√ 
:
√√ 
$str
√√ ,
,
√√, -
unique
ƒƒ 
:
ƒƒ 
true
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
≈≈ 	
	protected
»» 
override
»» 
void
»» 
Down
»»  $
(
»»$ %
MigrationBuilder
»»% 5
migrationBuilder
»»6 F
)
»»F G
{
…… 	
migrationBuilder
   
.
   
	DropTable
   &
(
  & '
name
ÀÀ 
:
ÀÀ 
$str
ÀÀ (
)
ÀÀ( )
;
ÀÀ) *
migrationBuilder
ÕÕ 
.
ÕÕ 
	DropTable
ÕÕ &
(
ÕÕ& '
name
ŒŒ 
:
ŒŒ 
$str
ŒŒ (
)
ŒŒ( )
;
ŒŒ) *
migrationBuilder
–– 
.
–– 
	DropTable
–– &
(
––& '
name
—— 
:
—— 
$str
—— (
)
——( )
;
——) *
migrationBuilder
”” 
.
”” 
	DropTable
”” &
(
””& '
name
‘‘ 
:
‘‘ 
$str
‘‘ '
)
‘‘' (
;
‘‘( )
migrationBuilder
÷÷ 
.
÷÷ 
	DropTable
÷÷ &
(
÷÷& '
name
◊◊ 
:
◊◊ 
$str
◊◊ (
)
◊◊( )
;
◊◊) *
migrationBuilder
ŸŸ 
.
ŸŸ 
	DropTable
ŸŸ &
(
ŸŸ& '
name
⁄⁄ 
:
⁄⁄ 
$str
⁄⁄ #
)
⁄⁄# $
;
⁄⁄$ %
migrationBuilder
‹‹ 
.
‹‹ 
	DropTable
‹‹ &
(
‹‹& '
name
›› 
:
›› 
$str
›› #
)
››# $
;
››$ %
}
ﬁﬁ 	
}
ﬂﬂ 
}‡‡ ˛

HC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\UserReadDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
UserReadDto 
{ 
public 
string 
Id 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
Name 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
Email 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
Role 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public		 
DateTime		 
	CreatedAt		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
}

 
} ¡	
HC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\RegisterDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
RegisterDto 
{ 
public 
string 
Email 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Name 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Role 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
$str/ 7
;7 8
}		 
}

 á
EC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\LoginDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
LoginDto 
{ 
public 
string 
Email 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
} 
} ¢
HC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\BookReadDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
BookReadDto 
{ 
public 
int 
Id 
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Title 
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
public 
string 

AuthorName  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
} 
}		 ∫
JC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\BookCreateDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
BookCreateDto 
{ 
public 
string 
Title 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int 
AuthorId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ≥
JC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\AuthorReadDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
AuthorReadDto 
{ 
public 
int 
Id 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} §
LC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Dtos\AuthorCreateDto.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Dtos 
{ 
public 

class 
AuthorCreateDto  
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ‰
UC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Data\BibliotecaContextFactory.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Data 
{ 
public 

class $
BibliotecaContextFactory )
: 	'
IDesignTimeDbContextFactory
 %
<% &
BibliotecaContext& 7
>7 8
{		 
public

 
BibliotecaContext

  
CreateDbContext

! 0
(

0 1
string

1 7
[

7 8
]

8 9
args

: >
)

> ?
{ 	
var 
options 
= 
new #
DbContextOptionsBuilder 5
<5 6
BibliotecaContext6 G
>G H
(H I
)I J
. 
	UseSqlite 
( 
$str 6
)6 7
. 
Options 
; 
return 
new 
BibliotecaContext (
(( )
options) 0
)0 1
;1 2
} 	
} 
} Æ	
NC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Data\BibliotecaContext.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Data 
{ 
public 

class 
BibliotecaContext "
:# $
IdentityDbContext% 6
<6 7
ApplicationUser7 F
>F G
{ 
public		 
BibliotecaContext		  
(		  !
DbContextOptions		! 1
<		1 2
BibliotecaContext		2 C
>		C D
options		E L
)		L M
:

 
base

 
(

 
options

 
)

 
{

 
}

 
public 
DbSet 
< 
Author 
> 
Authors $
=>% '
Set( +
<+ ,
Author, 2
>2 3
(3 4
)4 5
;5 6
public 
DbSet 
< 
Book 
> 
Books #
=>& (
Set) ,
<, -
Book- 1
>1 2
(2 3
)3 4
;4 5
} 
} »=
SC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Controllers\BooksController.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Controllers $
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
BooksController  
:! "
ControllerBase# 1
{ 
private 
readonly 
BibliotecaContext *
_ctx+ /
;/ 0
public 
BooksController 
( 
BibliotecaContext 0
ctx1 4
)4 5
=>6 8
_ctx9 =
=> ?
ctx@ C
;C D
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
BookReadDto& 1
>1 2
>2 3
GetAll4 :
(: ;
); <
{ 	
var 
books 
= 
await 
_ctx "
." #
Books# (
.( )
Include) 0
(0 1
b1 2
=>3 5
b6 7
.7 8
Author8 >
)> ?
.? @
ToListAsync@ K
(K L
)L M
;M N
return 
books 
. 
Select 
(  
b  !
=>" $
new% (
BookReadDto) 4
{5 6
Id 
= 
b 
. 
Id !
,! "
Title 
= 
b 
. 
Title $
,$ %

AuthorName 
= 
b 
. 
Author %
?% &
.& '
Name' +
??, .
$str/ <
} 
) 
; 
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
BookReadDto' 2
>2 3
>3 4
GetById5 <
(< =
int= @
idA C
)C D
{ 	
var   
b   
=   
await   
_ctx   
.   
Books   $
.!! 
Include!! &
(!!& '
x!!' (
=>!!) +
x!!, -
.!!- .
Author!!. 4
)!!4 5
."" 
FirstOrDefaultAsync"" 2
(""2 3
x""3 4
=>""5 7
x""8 9
.""9 :
Id"": <
==""= ?
id""@ B
)""B C
;""C D
if## 
(## 
b## 
==## 
null## 
)## 
return## !
NotFound##" *
(##* +
)##+ ,
;##, -
return$$ 
new$$ 
BookReadDto$$ "
{$$# $
Id%% 
=%% 
b%% 
.%% 
Id%% !
,%%! "
Title&& 
=&& 
b&& 
.&& 
Title&& $
,&&$ %

AuthorName'' 
='' 
b'' 
.'' 
Author'' %
?''% &
.''& '
Name''' +
??'', .
$str''/ <
}(( 
;(( 
})) 	
[,, 	
HttpPost,,	 
],, 
public-- 
async-- 
Task-- 
<-- 
ActionResult-- &
<--& '
BookReadDto--' 2
>--2 3
>--3 4
Create--5 ;
(--; <
BookCreateDto--< I
dto--J M
)--M N
{.. 	
var// 
book// 
=// 
new// 
Book// 
{//  !
Title//" '
=//( )
dto//* -
.//- .
Title//. 3
,//3 4
AuthorId//5 =
=//> ?
dto//@ C
.//C D
AuthorId//D L
}//M N
;//N O
_ctx00 
.00 
Books00 
.00 
Add00 
(00 
book00 
)00  
;00  !
await11 
_ctx11 
.11 
SaveChangesAsync11 '
(11' (
)11( )
;11) *
var33 
author33 
=33 
await33 
_ctx33 #
.33# $
Authors33$ +
.33+ ,
	FindAsync33, 5
(335 6
book336 :
.33: ;
AuthorId33; C
)33C D
;33D E
return44 
CreatedAtAction44 "
(44" #
nameof44# )
(44) *
GetById44* 1
)441 2
,442 3
new55 
{55 
id55 
=55 
book55 
.55  
Id55  "
}55# $
,55$ %
new66 
BookReadDto66 
{66  !
Id77 
=77  
book77! %
.77% &
Id77& (
,77( )
Title88 
=88  
book88! %
.88% &
Title88& +
,88+ ,

AuthorName99 
=99  
author99! '
?99' (
.99( )
Name99) -
??99. 0
$str991 >
}:: 
):: 
;:: 
};; 	
[>> 	
HttpPut>>	 
(>> 
$str>> 
)>> 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
Update??) /
(??/ 0
int??0 3
id??4 6
,??6 7
BookCreateDto??8 E
dto??F I
)??I J
{@@ 	
varAA 
bookAA 
=AA 
awaitAA 
_ctxAA !
.AA! "
BooksAA" '
.AA' (
	FindAsyncAA( 1
(AA1 2
idAA2 4
)AA4 5
;AA5 6
ifBB 
(BB 
bookBB 
==BB 
nullBB 
)BB 
returnBB $
NotFoundBB% -
(BB- .
)BB. /
;BB/ 0
bookCC 
.CC 
TitleCC 
=CC 
dtoCC 
.CC  
TitleCC  %
;CC% &
bookDD 
.DD 
AuthorIdDD 
=DD 
dtoDD 
.DD  
AuthorIdDD  (
;DD( )
awaitEE 
_ctxEE 
.EE 
SaveChangesAsyncEE '
(EE' (
)EE( )
;EE) *
returnFF 
	NoContentFF 
(FF 
)FF 
;FF 
}GG 	
[JJ 	

HttpDeleteJJ	 
(JJ 
$strJJ 
)JJ 
]JJ 
publicKK 
asyncKK 
TaskKK 
<KK 
IActionResultKK '
>KK' (
DeleteKK) /
(KK/ 0
intKK0 3
idKK4 6
)KK6 7
{LL 	
varMM 
bookMM 
=MM 
awaitMM 
_ctxMM !
.MM! "
BooksMM" '
.MM' (
	FindAsyncMM( 1
(MM1 2
idMM2 4
)MM4 5
;MM5 6
ifNN 
(NN 
bookNN 
==NN 
nullNN 
)NN 
returnNN $
NotFoundNN% -
(NN- .
)NN. /
;NN/ 0
_ctxOO 
.OO 
BooksOO 
.OO 
RemoveOO 
(OO 
bookOO "
)OO" #
;OO# $
awaitPP 
_ctxPP 
.PP 
SaveChangesAsyncPP '
(PP' (
)PP( )
;PP) *
returnQQ 
	NoContentQQ 
(QQ 
)QQ 
;QQ 
}RR 	
}SS 
}TT ûH
SC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Controllers\UsersController.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Controllers $
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UsersController  
:! "
ControllerBase# 1
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly 
SignInManager &
<& '
ApplicationUser' 6
>6 7
_signInManager8 F
;F G
public 
UsersController 
( 
UserManager 
< 
ApplicationUser '
>' (
userManager) 4
,4 5
SignInManager 
< 
ApplicationUser )
>) *
signInManager+ 8
)8 9
{ 	
_userManager 
= 
userManager &
;& '
_signInManager 
= 
signInManager *
;* +
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Login) .
(. /
[/ 0
FromBody0 8
]8 9
LoginDto: B
dtoC F
)F G
{ 	
var 
result 
= 
await 
_signInManager -
.- .
PasswordSignInAsync. A
(A B
dto 
. 
Email 
, 
dto 
. 
Password '
,' (
isPersistent) 5
:5 6
true7 ;
,; <
lockoutOnFailure= M
:M N
falseO T
)T U
;U V
if 
( 
! 
result 
. 
	Succeeded !
)! "
return   
Unauthorized   #
(  # $
new  $ '
{  ( )
message  * 1
=  2 3
$str  4 M
}  N O
)  O P
;  P Q
return"" 
Ok"" 
("" 
)"" 
;"" 
}## 	
[&& 	
HttpPost&&	 
(&& 
$str&& 
)&& 
]&& 
['' 	
	Authorize''	 
]'' 
public(( 
async(( 
Task(( 
<(( 
IActionResult(( '
>((' (
Logout(() /
(((/ 0
)((0 1
{)) 	
await** 
_signInManager**  
.**  !
SignOutAsync**! -
(**- .
)**. /
;**/ 0
return++ 
Ok++ 
(++ 
)++ 
;++ 
},, 	
[// 	
HttpPost//	 
(// 
$str// 
)// 
]// 
[00 	
	Authorize00	 
(00 
Roles00 
=00 
$str00 "
)00" #
]00# $
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
Register11) 1
(111 2
[112 3
FromBody113 ;
]11; <
RegisterDto11= H
dto11I L
)11L M
{22 	
var33 
user33 
=33 
new33 
ApplicationUser33 *
{44 
UserName55 
=55 
dto55 
.55 
Email55 $
,55$ %
Email66 
=66 
dto66 
.66 
Email66 !
,66! "
Name77 
=77 
dto77 
.77 
Name77 
}88 
;88 
var99 
createResult99 
=99 
await99 $
_userManager99% 1
.991 2
CreateAsync992 =
(99= >
user99> B
,99B C
dto99D G
.99G H
Password99H P
)99P Q
;99Q R
if:: 
(:: 
!:: 
createResult:: 
.:: 
	Succeeded:: '
)::' (
return;; 

BadRequest;; !
(;;! "
createResult;;" .
.;;. /
Errors;;/ 5
);;5 6
;;;6 7
var== 

roleResult== 
=== 
await== "
_userManager==# /
.==/ 0
AddToRoleAsync==0 >
(==> ?
user==? C
,==C D
dto==E H
.==H I
Role==I M
)==M N
;==N O
if>> 
(>> 
!>> 

roleResult>> 
.>> 
	Succeeded>> %
)>>% &
return?? 

BadRequest?? !
(??! "

roleResult??" ,
.??, -
Errors??- 3
)??3 4
;??4 5
returnAA 
OkAA 
(AA 
)AA 
;AA 
}BB 	
[EE 	
HttpGetEE	 
(EE 
$strEE 
)EE 
]EE 
[FF 	
	AuthorizeFF	 
]FF 
publicGG 
asyncGG 
TaskGG 
<GG 
ActionResultGG &
<GG& '
UserReadDtoGG' 2
>GG2 3
>GG3 4
MeGG5 7
(GG7 8
)GG8 9
{HH 	
varII 
userII 
=II 
awaitII 
_userManagerII )
.II) *
GetUserAsyncII* 6
(II6 7
UserII7 ;
)II; <
;II< =
ifJJ 
(JJ 
userJJ 
==JJ 
nullJJ 
)JJ 
returnKK 
UnauthorizedKK #
(KK# $
)KK$ %
;KK% &
varMM 
rolesMM 
=MM 
awaitMM 
_userManagerMM *
.MM* +
GetRolesAsyncMM+ 8
(MM8 9
userMM9 =
)MM= >
;MM> ?
returnOO 
newOO 
UserReadDtoOO "
{PP 
IdQQ 
=QQ 
userQQ 
.QQ 
IdQQ 
,QQ 
NameRR 
=RR 
userRR 
.RR 
NameRR  
,RR  !
EmailSS 
=SS 
userSS 
.SS 
EmailSS "
??SS# %
stringSS& ,
.SS, -
EmptySS- 2
,SS2 3
RoleTT 
=TT 
rolesTT 
.TT 
FirstOrDefaultTT +
(TT+ ,
)TT, -
??TT. 0
stringTT1 7
.TT7 8
EmptyTT8 =
,TT= >
	CreatedAtUU 
=UU 
userUU  
.UU  !
	CreatedAtUU! *
}VV 
;VV 
}WW 	
[ZZ 	
HttpGetZZ	 
]ZZ 
[[[ 	
	Authorize[[	 
([[ 
Roles[[ 
=[[ 
$str[[ "
)[[" #
][[# $
public\\ 
async\\ 
Task\\ 
<\\ 
ActionResult\\ &
<\\& '
IEnumerable\\' 2
<\\2 3
UserReadDto\\3 >
>\\> ?
>\\? @
>\\@ A
GetAll\\B H
(\\H I
)\\I J
{]] 	
var^^ 
users^^ 
=^^ 
await^^ 
_userManager^^ *
.^^* +
Users^^+ 0
.^^0 1
ToListAsync^^1 <
(^^< =
)^^= >
;^^> ?
var__ 
result__ 
=__ 
new__ 
List__ !
<__! "
UserReadDto__" -
>__- .
(__. /
)__/ 0
;__0 1
foreach`` 
(`` 
var`` 
user`` 
in``  
users``! &
)``& '
{aa 
varbb 
rolesbb 
=bb 
awaitbb !
_userManagerbb" .
.bb. /
GetRolesAsyncbb/ <
(bb< =
userbb= A
)bbA B
;bbB C
resultcc 
.cc 
Addcc 
(cc 
newcc 
UserReadDtocc *
{dd 
Idee 
=ee 
useree 
.ee 
Idee  
,ee  !
Nameff 
=ff 
userff 
.ff  
Nameff  $
,ff$ %
Emailgg 
=gg 
usergg  
.gg  !
Emailgg! &
??gg' )
stringgg* 0
.gg0 1
Emptygg1 6
,gg6 7
Rolehh 
=hh 
roleshh  
.hh  !
FirstOrDefaulthh! /
(hh/ 0
)hh0 1
??hh2 4
stringhh5 ;
.hh; <
Emptyhh< A
,hhA B
	CreatedAtii 
=ii 
userii  $
.ii$ %
	CreatedAtii% .
}jj 
)jj 
;jj 
}kk 
returnll 
Okll 
(ll 
resultll 
)ll 
;ll 
}mm 	
}nn 
}oo  1
UC:\Users\twtom\Desktop\IntegradorBEII\Biblioteca.Api\Controllers\AuthorsController.cs
	namespace 	

Biblioteca
 
. 
Api 
. 
Controllers $
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
AuthorsController "
:# $
ControllerBase% 3
{ 
private 
readonly 
BibliotecaContext *
_ctx+ /
;/ 0
public 
AuthorsController  
(  !
BibliotecaContext! 2
ctx3 6
)6 7
=>8 :
_ctx; ?
=@ A
ctxB E
;E F
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
AuthorReadDto& 3
>3 4
>4 5
GetAll6 <
(< =
)= >
=>? A
await 
_ctx 
. 
Authors 
. 
Select 
( 
a 
=> 
new  
AuthorReadDto! .
{/ 0
Id1 3
=4 5
a6 7
.7 8
Id8 :
,: ;
Name< @
=A B
aC D
.D E
NameE I
}J K
)K L
. 
ToListAsync 
( 
) 
; 
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
AuthorReadDto' 4
>4 5
>5 6
GetById7 >
(> ?
int? B
idC E
)E F
{ 	
var 
a 
= 
await 
_ctx 
. 
Authors &
.& '
	FindAsync' 0
(0 1
id1 3
)3 4
;4 5
if 
( 
a 
== 
null 
) 
return !
NotFound" *
(* +
)+ ,
;, -
return 
new 
AuthorReadDto $
{% &
Id' )
=* +
a, -
.- .
Id. 0
,0 1
Name2 6
=7 8
a9 :
.: ;
Name; ?
}@ A
;A B
} 	
[!! 	
HttpPost!!	 
]!! 
public"" 
async"" 
Task"" 
<"" 
ActionResult"" &
<""& '
AuthorReadDto""' 4
>""4 5
>""5 6
Create""7 =
(""= >
AuthorCreateDto""> M
dto""N Q
)""Q R
{## 	
var$$ 
author$$ 
=$$ 
new$$ 
Author$$ #
{$$$ %
Name$$& *
=$$+ ,
dto$$- 0
.$$0 1
Name$$1 5
}$$6 7
;$$7 8
_ctx%% 
.%% 
Authors%% 
.%% 
Add%% 
(%% 
author%% #
)%%# $
;%%$ %
await&& 
_ctx&& 
.&& 
SaveChangesAsync&& '
(&&' (
)&&( )
;&&) *
return(( 
CreatedAtAction(( "
(((" #
nameof((# )
((() *
GetById((* 1
)((1 2
,((2 3
new)) 
{)) 
id)) 
=)) 
author)) !
.))! "
Id))" $
}))% &
,))& '
new** 
AuthorReadDto** !
{**" #
Id**$ &
=**' (
author**) /
.**/ 0
Id**0 2
,**2 3
Name**4 8
=**9 :
author**; A
.**A B
Name**B F
}**G H
)**H I
;**I J
}++ 	
[.. 	
HttpPut..	 
(.. 
$str.. 
).. 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
Update//) /
(/// 0
int//0 3
id//4 6
,//6 7
AuthorCreateDto//8 G
dto//H K
)//K L
{00 	
var11 
a11 
=11 
await11 
_ctx11 
.11 
Authors11 &
.11& '
	FindAsync11' 0
(110 1
id111 3
)113 4
;114 5
if22 
(22 
a22 
==22 
null22 
)22 
return22 !
NotFound22" *
(22* +
)22+ ,
;22, -
a33 
.33 
Name33 
=33 
dto33 
.33 
Name33 
;33 
await44 
_ctx44 
.44 
SaveChangesAsync44 '
(44' (
)44( )
;44) *
return55 
	NoContent55 
(55 
)55 
;55 
}66 	
[99 	

HttpDelete99	 
(99 
$str99 
)99 
]99 
public:: 
async:: 
Task:: 
<:: 
IActionResult:: '
>::' (
Delete::) /
(::/ 0
int::0 3
id::4 6
)::6 7
{;; 	
var<< 
a<< 
=<< 
await<< 
_ctx<< 
.<< 
Authors<< &
.<<& '
	FindAsync<<' 0
(<<0 1
id<<1 3
)<<3 4
;<<4 5
if== 
(== 
a== 
==== 
null== 
)== 
return== !
NotFound==" *
(==* +
)==+ ,
;==, -
_ctx>> 
.>> 
Authors>> 
.>> 
Remove>> 
(>>  
a>>  !
)>>! "
;>>" #
await?? 
_ctx?? 
.?? 
SaveChangesAsync?? '
(??' (
)??( )
;??) *
return@@ 
	NoContent@@ 
(@@ 
)@@ 
;@@ 
}AA 	
}BB 
}CC 